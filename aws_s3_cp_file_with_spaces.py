import boto3
import logging
import subprocess
#from urllib.parse import quote,quote_plus

# Create a custom logger
logger = logging.getLogger('bucket_logging')

# Create handlers
c_handler = logging.StreamHandler()
f_handler = logging.FileHandler('s3_bucket.txt')
logger.setLevel(logging.INFO)
logger.setLevel(logging.INFO)

# Create formatters and add it to handlers
c_format = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
f_format = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
c_handler.setFormatter(c_format)
f_handler.setFormatter(f_format)

# Add handlers to the logger
logger.addHandler(c_handler)
logger.addHandler(f_handler)

info = ['66747/Clients/829225/Client Information/Koenig Brothers Vitals 2021.xlsx']
# ['66747/clients/409811/Payroll 2018/2018-09-14 Rose Orchards.pdf', '66747/clients/481063/Payroll 2018/2018-10-17 86 Dylan Matthews Retro.pdf', '66747/clients/283115/Payroll 2018/2018-12-21WernerAdditional.pdf', '66747/clients/706240/Payroll 2018/2018-10-18 ReturnedCCD.pdf', '66747/clients/418834/Payroll 2018/2018-12-06 Pettengill.pdf', '66747/clients/451608/Payroll 2019/2019-02-08 Mann.pdf', '66747/clients/691667/Payroll 2019/2019-05-08.pdf', '66747/Clients/641530/Employee Information/Waltz Hunter EE info.pdf', '66747/clients/280531/Payroll 2018/2018-10-27Price.pdf', '66747/clients/356954/Payroll 2019/2019-03-29 Gardens Dream.pdf', '66747/Clients/359872/Employee Information/Julie Beaulieu/Julie Beaulieu.pdf', '66747/clients/515097/Payroll 2019/2019-05-17.pdf', '66747/clients/302505/Payroll 2019/2019-02 Mecox.pdf', '66747/clients/302505/Payroll 2019/2019-05 Mecox.pdf', '66747/clients/519622/Payroll 2019/2019-05-13.pdf', '66747/Clients/405800/1Pending/Jason Mnthly Insurance.xlsx', '66747/clients/461068/Payroll 2019/Retirement Contributions/July Retirement Contributions.pdf', '66747/clients/627769/Payroll 2019/2019-05-10.pdf', '66747/clients/482858/Payroll 2019/2019-04-19 CSBF.pdf', '66747/clients/743354/Payroll 2019/2019-08-15 Rooted.pdf', '66747/clients/280452/Payroll 2019/2019-07-12 Balleks.pdf', '66747/clients/677529/Payroll 2019/2019-08-30 Freedom Food.pdf', '66747/clients/406062/Payroll 2019/2019-11-27 JT.pdf', '66747/clients/604412/Payroll 2019/2019-09-13 Halsey.pdf', '66747/clients/602251/Payroll 2020/2020-02-28 JM.pdf', '66747/clients/602251/Payroll 2020/2020-03-06 JM.pdf', '66747/clients/602251/Payroll 2020/2020-01-24 JM.pdf', '66747/clients/339947/Payroll 2019/Q3 2019 WPR.pdf', '66747/clients/602251/Payroll 2020/2020-01-17 JM.pdf', '66747/clients/281271/Payroll 2019/Q1 2019 Gilbert Farm.pdf', '66747/clients/297509/Payroll 2019/2019-10-17 Balsam.pdf', '66747/Clients/513444/Client Information/Rec Sheet FSF.xls', '66747/clients/596381/Payroll 2019/Q3 2019 OPF.pdf', '66747/clients/439007/Payroll 2020/2020-02-21 NKN.pdf', '66747/Clients/648413/Client Information/Vital - Currier Orchards.xlsx', '66747/Clients/354511/Client Information/Vital - Sauchuk.xlsx', '66747/clients/735872/Payroll 2020/2020-04-03 Time.pdf', '66747/Clients/297509/Client Information/Vital - Balsam Farms.xlsx', '66747/clients/495937/Payroll 2020/2019-12-27 Robert Adair Timesheet.pdf', "66747/clients/434727/Payroll 2020/2020-03-12 Goff's Equipment.pdf", '66747/clients/643139/Payroll 2019/Q1 2019 NEAC.pdf', '66747/clients/297122/Payroll 2020/2020-02-14 PCN.pdf', '66747/clients/366801/Payroll 2020/2020-03-13 First Blue.pdf', '66747/Clients/484422/Client Information/Vital - Glover Perennials.xlsx', '66747/Clients/696533/Client Information/Vital - Soons Orchards.xlsx', '66747/clients/763351/Payroll 2020/Mapleview Dairy Q1 FCE Copy.pdf', '66747/clients/435821/Payroll 2019/Q3 2019 DRF.pdf', '66747/clients/282817/Payroll 2020/2020-03-12 Lyman Agency.pdf', '66747/clients/602251/Payroll 2020/2020-02-21 JM.pdf', '66747/Clients/289863/Client Information/Permanent Info Folder/Client Info.pdf', '66747/Clients/408541/Client Information/MVVital Statistics_all formats.xlsx', '66747/clients/366801/Payroll 2020/2020-02-28 First Blue Timesheet.pdf', '66747/Clients/738585/Client Information/Vital - Acre Farm.xlsx', '66747/Clients/297122/Client Information/Rec Sheet_PCN.xls', '66747/clients/282766/Payroll 2020/2020 Q1 SUTA BSA.pdf', '66747/clients/602251/Payroll 2020/2020-02-14 JM.pdf', '66747/Clients/482858/Payroll 2020/2020-03-13 CSB.pdf', '66747/clients/264044/Payroll 2020/2020-03-27 NE Calendar.pdf', '66747/Clients/356954/Client Information/Vital - Gardens Dream.xlsx', '66747/clients/768432/Payroll 2020/2020 Q1 BLV.pdf', 
# '66747/clients/281271/Payroll 2019/Q2 2019 Gilbert Farm.pdf', '66747/Clients/312424/Client Information/Qtrly Memo_WW.doc', '66747/clients/512117/Payroll 2020/2020-07-03 K&J FARM ADV.pdf', '66747/Clients/466707/Client Information/Vital Statistics_Holy Schmitts.xlsx', '66747/Clients/774617/Client Information/Vital - South County Farms.xlsx', '66747/clients/735872/Payroll 2020/Q2.pdf', '66747/Clients/811282/Client Information/Jersey Farm Produce.xlsx', '66747/clients/545387/Payroll 2020/2020 Q2 AFS.pdf', '66747/Clients/814042/Client Information/Suydam Vitals.xlsx', '66747/Clients/604541/Client Information/Vital Statistics_Instructions NFE.xlsx', '66747/Clients/779380/Client Information/Vital - King Farm.xlsx', '66747/clients/282765/Payroll 2020/2020 Q3 BFH.pdf', '66747/Clients/690080/Client Information/Enfield Vital Statistics Sweet berry farmxlsx.xlsx', '66747/Clients/302505/Client Information/Vital - Mecox Bay Dairy.xlsx', 
# '66747/Clients/297509/Client Information/Balsam Farm Weekly Rec. Sheet.xls', '66747/clients/768430/Payroll 2020/2020 Q3 PWG.pdf', '66747/Clients/280524/Client Information/Permanent Info Folder/Vital - Fresh Egg Farmstand.xlsx', '66747/Clients/521987/Client Information/Permanent Info Folder/Vital Statistics_Benedikt Dairy.xlsx', '66747/Clients/521987/Client Information/Permanent Info Folder/Vital Statistics_Benedikt Dairy.xlsx', '66747/clients/601484/Payroll 2020/2020-02-05 Time.pdf', '66747/clients/285928/Payroll 2020/2020-02-27 OFG.pdf', '66747/clients/693650/Payroll 2020/2020-03-06 Bi-Weekly Recon.xls', '66747/Clients/417026/Client Information/Permanent Info Folder/Vital - Phantom Properties.xlsx', '66747/Clients/566115/Client Information/Permanent Info Folder/Vital Statistics_John C Burney.xlsx', '66747/Clients/812494/Client Information/Freiberger Vital Statistics.xlsx', '66747/Clients/282941/Client Information/NFGreenhouserecon.xls', '66747/Clients/433241/Client Information/Tendercrop at the Red Barn Instructions.docx', '66747/Clients/802418/Client Information/Cornwall Coal Vitals.xlsx', '66747/clients/285928/Payroll 2020/2020-08-06 OFG.pdf', '66747/Clients/313358/Client Information/TendercropWklyRecon.xls', '66747/clients/601484/Payroll 2020/2020-07-08 Time.pdf', '66747/Clients/408541/Client Information/Rec Sheet_MVF.xlsx', '66747/Clients/282417/Client Information/Vital Statistics_Lascho.xlsx', '66747/Clients/823738/Client Information/Colfax Farm Vitals.xlsx', '66747/clients/451798/Payroll 2020/New Hire Reporting/July.pdf', '66747/Clients/622973/Client Information/Natureworks Processing Instructions.docx', '66747/Clients/451798/Client Information/Vital Statistics_PSF.xlsx', '66747/clients/417217/Payroll 2020/2020-09-18 Hinckley Farms Timesheet.pdf', '66747/clients/545387/Payroll 2020/2020 Q2 AFS.pdf', '66747/Clients/771657/Client Information/Vital - Chase Farms Inc.xlsx', '66747/Clients/829609/Client Information/Grazin Diner 2021 Vitals.xlsx', '66747/Clients/706240/Client Information/Vital Statistics _ LAS Logging.xlsx', '66747/Clients/813167/Client Information/Friends of Howell Vitals .xlsx', '66747/clients/768430/Payroll 2020/2020 Q3 PWG.pdf', '66747/Clients/482813/Client Information/Bowman Wkly Rec.xls', '66747/Clients/313358/Client Information/Tendercrop Farm - PPP Report Requests.pdf', '66747/Clients/813163/Client Information/Chelsea Forge Vinters LLC Vital Statistics .xlsx', '66747/Clients/283554/Client Information/Permanent Information/Vital Statistics-Seatuck Nursery.xlsx', '66747/Clients/481063/Client Information/Enfield Vital Stats AD Bowman.xlsx', '66747/Clients/819282/Client Information/Brookrest Sod Farm LLC 2020.xlsx', '66747/Clients/545046/Client Information/Vital - Morell Farm LLC .xlsx', '66747/Clients/481063/Client Information/AD Bowman Wkly Rec.xlsx', '66747/Clients/824456/Client Information/Giamarese Farm Vital Statistics 2020.xlsx', '66747/clients/770690/Payroll 2020/2020-12-08 BHO.pdf', '66747/Clients/829225/Client Information/Koenig Brothers Vitals 2021.xlsx', '66747/Clients/589215/Client Information/Stone Soup Vital Statistics_all formats - Copy.xlsx', '66747/Clients/836602/Client Information/Town of Claverack Vitals 2021.xlsx', '66747/clients/544897/Payroll 2020/2020-04-24 PTF.pdf', '66747/Clients/821732/Client Information/Vital - Smokedown.xlsx', '66747/Clients/821732/Client Information/Vital - Smokedown.xlsx', '66747/Clients/443598/Client Information/Enfield Vital Stats Scotts Orchard .xlsx', '66747/Clients/829842/Client Information/Kukon Brothers LLC Vitals 2021.xlsx', '66747/Clients/811576/Client Information/AKC Inc Vitals 2020 .xlsx', '66747/Clients/693505/Client Information/Enfield Vital Stats Nursery Direct .xlsx', '66747/Clients/769286/Client Information/Summit Vital .xlsx', '66747/Clients/336883/Client Information/Vital Statistics_Instructions JAF .xlsx', '66747/clients/283562/Payroll 2020/2020-05-26 Trimbles.pdf', '66747/Clients/743891/Client Information/Cushman Farms Limited Vital Stats.xlsx', '66747/Clients/818190/Client Information/Thomas Corcoran Vital.xlsx', '66747/Clients/836602/Client Information/Town of Claverack Vitals 2021.xlsx', '66747/Clients/770620/Client Information/Vital Statistics - Founders.xlsx', '66747/Clients/699760/Client Information/Enfield Vital Stats Eames Associates .xlsx', '66747/Clients/811276/Client Information/Samaha Vitals.xlsx', '66747/Clients/312577/Client Information/Rec Sheet_BWF .xls', '66747/Clients/571598/Client Information/Vital Statistics_Instructions OMO.xlsx', '66747/Clients/513444/Client Information/Permanent Info Folder/Vital Statistics_ FSF.xlsx', '66747/clients/282425/Payroll 2021/20221-04-01 Payroll Reports Locust Avenue Farmspdf.pdf', '66747/Clients/281008/Client Information/Vital Statistics_Catapano Dairy.xlsx', '66747/Clients/768431/Client Information/Vital Statistics ORW.xlsx', '66747/Clients/829392/Client Information/Derek Loomis Timber Harvesting Vitals 2021 .xlsx', '66747/Clients/815158/Client Information/Kuperus Custom Fence Vitals .xlsx', '66747/Clients/506794/Client Information/Vital Statistics_MACD .xlsx', '66747/Clients/814050/Client Information/Upper Creek Vital Statistics.xlsx', '66747/Clients/810842/Client Information/Gasko Family Farm Vitals.xlsx', '66747/clients/281306/Payroll 2021/2021-02-03 Jacob H. Rottkamp.pdf', '66747/Clients/817303/Client Information/Ron Lee Vitals.xlsx', '66747/Clients/699558/Client Information/Enfield Vital Stats Fort Mountain .xlsx', '66747/Clients/513444/Client Information/Vital Statistics_ FSF.xlsx', '66747/Clients/297122/Client Information/Permanent Info Folder/Banking Info.pdf', '66747/Clients/513444/Client Information/Permanent Info Folder/Rec Sheet FSF.xls', '66747/Clients/693505/Client Information/Permanent Info Folder/Enfield Vital Stats Nursery Direct .xlsx', '66747/Clients/604541/Client Information/Permanent Info Folder/Vital Statistics_Instructions NFE.xlsx', '66747/Clients/336883/Client Information/Permanent Info Folder/Vital Statistics_Instructions JAF .xlsx', '66747/Clients/313358/Client Information/Enfield Vital Stats Tendercrop.xlsx']

#Declare needed 
s3 = boto3.client('s3')
source_bucket = 'cloudcabinet-backup-pre-purge-02-17-2021-oregon-region'
destination_bucket = 'CyberCabinet'



for key in info:
    key=key.lower()
    source_file = "{}/{}".format('prod',key)
    source = {'Bucket': source_bucket,'Key': source_file}
    print(source_file)
    print(source)
    
    try:
        logger.info(key)
        logger.info(s3.copy_object(CopySource=source,Bucket=destination_bucket,Key=key,ServerSideEncryption='AES256'))
        logger.info("================================================================================================")
        
    except Exception as err:
        logger.error(f'{err}- {key}')
        logger.error("================================================================================================")

# with open('D:\\Education\\git-operations\\s3_copy\\missing_files.txt','r') as missedfile:
#     data = missedfile.readlines()
#     for x in data:
#         info.append(x[13:].replace('\n',''))
# print(info)
# for x in info:
#     print(x)

